<%=render 'transaction_breadcrumb' %>

<div class="row">
  <div class="advanceSearchForm">
    <!-- left part -->
    <div class="col-md-6">
      <!-- SatrtDate EndDate -->
      <div class="row btn_Search">
        <label class="control-label col-md-3">Date</label>
        <div class="input-group input-large date-picker input-daterange col-md-9" style="padding-left: 15px;" data-date="10/11/2012" data-date-format="mm/dd/yyyy">
          <input type="text" class="form-control start_date" name="from">
          <span class="input-group-addon">to </span>
          <input type="text" class="form-control end_date" name="to">
        </div>
      </div>

      <!-- Invoice id -->
       <div class="row btn_Search">
        <div><label class="control-label col-md-3">Instructor</label>
          <div class="col-md-9">
            <select class="form-control advance_instructor">
              <option></option>
              <%Instructor.all.each do |instructor| %>
                <option value="<%=instructor.id%>"><%=instructor.name%></option>
              <%end%>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- right part -->
    <div class="col-md-6">

       <!-- Paid By -->
      <div class="row btn_Search">
        <label class="control-label col-md-2">Paid By</label>
        <div class="col-md-9">
          <select class="form-control advance_paidBy">
            <option></option>
            <option>Cash</option>
            <option>Reddot Visa/Master</option>
            <option>Reddot eNets</option>
          </select>
        </div>
      </div>

      <!-- Status -->
      <div class="row btn_Search">
        <label class="control-label col-md-2">Status</label>
        <div class="col-md-9">
          <select class="form-control advance_status">
            <option></option>
            <option>Added</option>
            <option>Rejected</option>
            <option>Completed</option>
            <option>Paid</option>

          </select>
        </div>
      </div>      
    </div>
  </div>
</div>

<!-- button --> 
<div class="row btn_Search">
  <div class="col-md-offset-5">
    <a href="javascript:;" class="btn btn-default search_btn">Search</a>
    <a href="javascript:;" class="btn btn-default resetAdvanceSearch">Reset </a>
  </div>
</div>
<div>
  <table id="sample_2" class="table table-striped table-bordered table-hover table-full-width" data-source="<%=accountant_instructor_test_path(format: :json) %>">
    <thead>
      <tr class="heading">
        <th class="hidden-xs">Date</th>
        <th class="hidden-xs">Test Id</th>
        <th class="hidden-xs">Amount</th>
        <th class="hidden-xs">Fee</th> 
        <th class="hidden-xs">Student</th>
        <th class="hidden-xs">Paid By</th>
        <th class="hidden-xs">status</th>
        <th class="hidden-xs">Instructor</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>
</div>
<script type="text/javascript">
var table;
$(document).ready(function() {
	table = $('#sample_2').dataTable({
			sPaginationType: "bootstrap",
      aaSorting: [[ 0, "desc" ]],
      aLengthMenu: [
      [20, 50, 100, -1],
      [20, 50, 100, "All"] // change per page values here
      ],
	    iDisplayLength: 20,
      bProcessing: true,
      bServerSide: true,
	    sAjaxSource: $('#sample_2').data('source'),
      "fnServerParams" : function ( aoData ) {
      //here can be added an external ajax request parameters.
      aoData.push({"name" : "paid_by", "value": $('.advance_paidBy').val()});
      aoData.push({"name" : "status", "value": $('.advance_status').val()});
      aoData.push({"name" : "instructor", "value": $('.advance_instructor').val()});
      aoData.push({"name" : "start_date", "value": $('.start_date').val()});
      aoData.push({"name" : "end_date", "value": $('.end_date').val()});
      },
       "fnDrawCallback" : function(oSettings){
        if (oSettings.aiDisplay.length == 0) {
            $("#total_amount").html("0");
            $("#paid_fee").html("0");
            return;
        }
        // sum columns within goups
        var total_amount=0;
        var paid_count=0;
        $("#sample_2 tbody tr").each(function(index) {
          if (this.cells[2].innerHTML){ 
            total_amount = parseFloat(total_amount) + parseFloat(this.cells[2].innerHTML);
          }
          if (this.cells[5].innerHTML){
            if (this.cells[5].innerHTML=="Paid")
            {
              paid_count = paid_count + 1;
            }
          }
          $("#total_amount").html(total_amount);
          $("#paid_fee").html(paid_count);

        });
      }
    });
		// // $('#sample_2_wrapper .dataTables_filter input').addClass("form-control input-xmedium input-inline");
    $('#sample_2_wrapper .dataTables_length select').addClass("form-control input-xmedium input-inline");
    // $("#sample_2_wrapper").find(".table-scrollable").removeClass("table-scrollable");

    $('#sample_2_filter').append('<label class="p-label"><span>Paid :  <span id="paid_fee"></span></span><span id="m-total" >Total : <span id="total_amount"> </span></span></label>');

  // search button
  $('.search_btn').click(function(){
      table.fnFilter( );
  });
  $('.date-picker').datepicker({
    format: 'd MM yyyy',
    autoclose: true
  });

  // reset button 
  $(document).on("click", '.resetAdvanceSearch', function(){
    $('.advanceSearchForm').find('input, select').val('');
    $('.date-picker').datepicker('setDate', null);
  });
});
</script>
<style type="text/css">
  .btn_Search{

    margin: 10px;
  }
  #m-total{
    margin-left: 40px;
    margin-right: 20px;
  }
  .p-label{
    padding-top: 4px;
  }
</style>
