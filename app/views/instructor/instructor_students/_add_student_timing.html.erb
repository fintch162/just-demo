<%if params[:instructor_student].present?%>
  <%=form_for [:instructor,@instructor_student_timing],remote: :true do |f| %>
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel">Add Timing</h4>
          </div>
          <div class="modal-body">
            <%=@timing.title %>
              <div class="form-group">
                <div class="field">
                  <%= f.label :date %><br>
                  <div class="input-group input-medium date date-picker" data-date-format="dd-mm-yyyy">
                    <%= f.text_field :date, :class => "form-control" , :required=>"required", value: @latest_lesson_date.strftime('%e %B %Y')%>
                    <span class="input-group-btn">
                      <button class="btn default" type="button" style="height: 34px;"><i class="fa fa-calendar"></i></button>
                    </span>
                  </div>
                </div>
                <div class="field">
                  <%= f.label :time %><br>
                  <div class="input-group input-medium " data-date-format="mm:ss">
                    <%= f.text_field :time,:class=>"form-control timepicker",:required=>"required", :maxlength=>"4"%>
                    <span class="input-group-btn">
                    <button class="btn default" type="button"><i class="fa fa-clock-o"></i></button>
                    </span>
                  </div>
                </div>
              </div>
          </div>
          <%=f.hidden_field :instructor_student_id ,:value=>@instructor_student.id %>
          <%=f.hidden_field :timing_id ,:value=>@timing.id %>
          <div class="modal-footer">
            <%= f.submit "Add Timing" ,:class=>"btn green save_payment",:id=>"add_timing_button"%>
          </div>
        </div>
    </div>
  <%end %>
<%else %>
  <%=form_for [:instructor,@instructor_student_timing],remote: :true do |f| %>
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel">Edit Timing</h4>
          </div>
          <div class="modal-body">
            <%=@instructor_student_timing.timing.title %>
              <div class="form-group">
                <div class="field">
                  <%= f.label :date %><br>
                  <div class="input-group input-medium date date-picker1" data-date-format="dd-MM-yyyy">
                    <%= f.text_field :date, :class => "form-control" , :required=>"required",:value=>@instructor_student_timing.date.strftime('%d %B %Y')%>
                    <span class="input-group-btn">
                      <button class="btn default" type="button" style="height: 34px;"><i class="fa fa-calendar"></i></button>
                    </span>
                  </div>
                </div>
                <div class="field">
                  <%= f.label :time %><br>
                  <div class="input-group input-medium " data-date-format="mm:ss">
                    <%= f.text_field :time,:class=>"form-control timepicker",:required=>"required", :maxlength=>"4" , :value=>@instructor_student_timing.time.strftime('%M:%S') %>
                    <span class="input-group-btn">
                    <button class="btn default" type="button"><i class="fa fa-clock-o"></i></button>
                    </span>
                  </div>
                </div>
              </div>
          </div>
          <%=f.hidden_field :instructor_student_id ,:value=>@instructor_student_timing.instructor_student_id %>
          <%=f.hidden_field :timing_id ,:value=>@instructor_student_timing.timing_id %>
          <div class="modal-footer">
            <%= link_to "Remove",instructor_instructor_student_timing_path(@instructor_student_timing.id,:instructor_student=>@instructor_student_timing.instructor_student_id,:time=>@instructor_student_timing.timing_id),:class=>"btn red save_payment",:id=>"remove_timing_button",:method=>"DELETE",:remote=>"true"%>
            <%= f.submit "Save" ,:class=>"btn green save_payment",:id=>"edit_timing_button"%>
          </div>
        </div>
    </div>
  <%end %>
<%end %>

<script type="text/javascript">

 $('.date-picker').datepicker({
      format: 'd MM yyyy',
      autoclose: true,
  });

  $('.date-picker1').datepicker({
      format: 'd MM yyyy',
      autoclose: true,
  })
  
  var ss,mm,time
  $(document).ready(function(){
    $(document).on('keypress','#instructor_student_timing_time',function(event){
       var x = event.which || event.keyCode;
       // if(x==9 || x==46 || (x >= 65 && x <= 90) || (x >= 97 && x <= 122) || (x >=33 && x <=47) || (x >=58 && x <=64))
        if((x >= 48 && x <= 57) || x==13)
          {
            // console.log(x);
          }
        else{
            event.preventDefault();
        }
    });

    $('#add_timing_button').click(function(event) {
     if($('#instructor_student_timing_time').hasClass('error_msg')){
        event.preventDefault();
     }
    });

    $(document).on('change','#instructor_student_timing_time',function(event){
        var text_value=$('#instructor_student_timing_time').val();
          if(text_value.length == 4 || text_value.indexOf(':')!= -1)
          {
            text_value=text_value.replace(':', '')
            mm=text_value.slice(0,2);
            ss=text_value.slice(2,4);
            error_fun(ss,mm);
            time =mm+":"+ss
          }
          if(text_value.length == 3 || text_value.indexOf(':')!= -1)
          {
            text_value=text_value.replace(':', '')
            mm=text_value.slice(0,1);
            ss=text_value.slice(1,3);
            error_fun(ss,mm);
            time =mm+":"+ss
           
          }
          if(text_value.length == 2 || text_value.indexOf(':')!= -1)
          {
            text_value=text_value.replace(':', '')
            ss=text_value
            mm=00
            error_fun(ss,mm);
            time ="00:"+ss

          }
          if(text_value.length == 1 || text_value.indexOf(':')!= -1)
          {
            text_value=text_value.replace(':', '')
            ss=text_value
            mm=00
            error_fun(ss,mm);
            time ="00:0"+ss
        
          }
          console.log(time);
          $('#instructor_student_timing_time').val(time);
    });
  });

  function error_fun(sec,min)
  {
    if(min >= 60 || sec >=60 )
    {
      $('#instructor_student_timing_time').addClass('error_msg')
    }
    else
    {
      $('#instructor_student_timing_time').removeClass('error_msg')
    }
  }

</script>

<style type="text/css">

.error_msg{
  border-color: #FF0000!important;
}
#add_timing_button{
  margin-right: 33%;
}
#edit_timing_button{
  margin-right: 15%;
}
</style>
