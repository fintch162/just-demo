<div class="col-md-6 col-sm-6">
  <div style="margin-bottom: 60px;">
    <div class="input-cont" style="margin-right: 0px !important;">
      <textarea class="form-control" placeholder="Type a message here..." id="instructor_message_template" onkeyup="textAreaAdjust(this)" style="overflow:hidden" rows="3" ></textarea>
    </div>
    <div id="instructor_message_msg">
      <a href="javascript:;" class="btn blue pull-right" style="margin-top: 10px;" id="instructor_send_message"> SMS</a>
    </div>
    <span class="pull-left sms_status" id="inst_message_status"></span>
  </div>
  <div class="portlet">
    <div class="portlet-title line">
      <div class="caption">
        <i class="fa fa-comments"></i>
        Instructor - <span id="inst_number" data-name="instructor_contact"></span>
      </div>
    </div>
    <div class="portlet-body" id="chats">
      <div class="slimScrollDiv">
        <div class="scroller inst_scroller" data-always-visible="1" data-initialized="true" data-rail-visible1="1">
          <ul class="chats" id="instructor_conversation">
            <!-- AJAX CONVERSATION LOAD CONTENT AREA -->
            <%#= render "instructor_messages" %>
          </ul>
          <span class="loading_p_inst" style="display: none;">
            <p style="text-align: center;">Loading...</p>
          </span>
          <button class="btn btn-xs blue default pull-right" id="load_more_sms"> Load More </button>
          <%# if @instructor_messages.count > 0 %>
          <%# if @instructor_messages.next_page %>
            <%#= link_to "Load More", manage_instructor_load_more_message_path(:job_id => @job.id, :page => @instructor_messages.next_page), :remote => true, :id => "load_more_message" %>
          <%# end %>
          <%# end %>
        </div>
      </div>
    </div>
  </div>
</div>
<input type="hidden" value="" class="next_marker_inst" id="next_marker_inst" name="next_marker_inst"/>
<input type="hidden" value="2" class="page" id="message_page" name="next_page"/>
<script type="text/javascript">
// $('#load_more_posts').show().click(function() {
//     var $this, more_posts_url;
//     if (!loading_posts) {
//       loading_posts = true;
//       more_posts_url = $('.pagination .next_page a').attr('href');
//       $this = $(this);
//       $this.html('<img src="/assets/ajax-loader.gif" alt="Loading..." title="Loading..." />').addClass('disabled');
//       $.getScript(more_posts_url, function() {
//         if ($this) {
//           $this.text('More posts').removeClass('disabled');
//         }
//         return loading_posts = false;
//       });
//     }
//   });
  $(document).on('click', '#load_more_sms', function(event) {
    event.preventDefault();
    var instructor_name_val = $("#job_instructor_id option:selected").text();
      if(instructor_name_val == "Please Select" || instructor_name_val == "")
        return false;
      else {
        instructor_name_val = instructor_name_val.split('(');
        if($("#job_instructor_id").val() != "" && $("#message_page").val() != 0 && flag_s == 0){
            flag_s = 1
            $.ajax({
              url: '/manage/load_msg',
              dataType: 'script',
              data: { page: $("#message_page").val(), inst: $("#job_instructor_id").val() },
              beforeSend: function(){
                $(".loading_p_inst").show();
              }
            })
            .done(function(data) {
            })
            .always(function(data) {
              $(".loading_p_inst").hide();
              flag_s = 0;
            });
        }
        else{
          return false;
        }
      }
  });
  // $(window).scroll(function() {
  //   var instructor_name_val = $("#job_instructor_id option:selected").text();
  //   if(instructor_name_val == "Please Select" || instructor_name_val == "")
  //     return false;
  //   else {
  //     instructor_name_val = instructor_name_val.split('(');
  //     phone_id = $.trim(instructor_name_val[1].replace(')',''))
  //     var next_marker = $("#next_marker_inst").val();
  //     if ($(window).scrollTop() > $(document).height() - $(window).height() - 10) {
  //       if(next_marker != ""){
  //         if(flag_s == 0){  
  //           $.ajax({
  //             url: '/manage/load_msg',
  //             data: { phone: phone_id, marker: $("#next_marker_inst").val() },
  //             beforeSend: function(){
  //               $(".loading_p_inst").show();
  //             }
  //           })
  //           .done(function(data) {
  //           })
  //           .always(function(data) {
  //             $(".loading_p_inst").hide();
  //             var json_data = JSON.parse(data);
  //             showConversationOnScroll(json_data, "instructor_conversation")
  //             $("#next_marker_inst").val(data.next_marker);
  //             flag_s = 0;
  //           });
  //         }
  //       }
  //       else{
  //         return false;
  //       }
  //     }
  //   }
  // });
</script>
<style type="text/css">
.sms_status{
  margin-top: 17px;
}
</style>
