<% cnt = 1 %>
<% @manual_payments.each_with_index do |manual_payment, index| %>
  <% job = Job.find(manual_payment.job_id) %>
  <%= render "manual_payment_data", manual_payment: manual_payment, job: job, index: index %>
  <% cnt += 1 %>
<% end %>
<script type="text/javascript">
  $(document).ready(function() {
    $('.best_in_place').best_in_place();

    $('#manualPayments').sortable({
      axis: "y",
      update: function() {
        $.post($(this).data("update-url"), $(this).sortable("serialize"));
      }
    });
    var cnt = 0;

    $('.date-picker').datepicker({
      format: 'd MM yyyy',
      autoclose: true
    }).on('changeDate', function(data){
      var selectedDate = moment(data.date).format('YYYY-MM-DD');
      $("#selectedPaymentDate").val(selectedDate);
      var url = '<%= manage_find_manual_payment_by_date_path %>';
      var payment_desc = $(".selectedPaymentDesc").val();
      if(cnt == 0) {
        $.ajax({
          url : url,
          method : 'GET',
          data: { selectedDate: selectedDate, payment_desc: payment_desc }
        }).done(function() {
          cnt = 1;
        });
      }
    });
  });
</script>